name: üìß Notificaciones Autom√°ticas - Cron Job

on:
  schedule:
    # Ejecutar cada hora en la hora exacta
    # 0 * * * * = Cada hora (UTC)
    - cron: '0 * * * *'
  
  # Permite disparo manual desde GitHub Actions
  workflow_dispatch:

jobs:
  check-notifications:
    runs-on: ubuntu-latest
    name: Verificar y enviar notificaciones
    
    steps:
      - name: üìå Informaci√≥n del Job
        run: |
          echo "üöÄ Iniciando verificaci√≥n de notificaciones autom√°ticas"
          echo "‚è∞ Hora actual (UTC): $(date -u '+%Y-%m-%d %H:%M:%S')"
          echo "üîó Backend: ${{ secrets.BACKEND_URL }}"

      - name: üìß Ejecutar verificaci√≥n de notificaciones
        run: |
          curl -X POST \
            "${{ secrets.BACKEND_URL }}/api/v1/admin/notificaciones-automaticas/check-now" \
            -H "Content-Type: application/json" \
            -w "\n‚úÖ HTTP Status: %{http_code}\n" \
            --max-time 30 \
            --retry 3 \
            --retry-delay 5 \
            --retry-max-time 60
        env:
          BACKEND_URL: ${{ secrets.BACKEND_URL }}
        continue-on-error: true

      - name: ‚úÖ Notificaci√≥n de √©xito
        if: success()
        run: echo "‚úÖ Verificaci√≥n de notificaciones completada correctamente"

      - name: ‚ö†Ô∏è Notificaci√≥n de error (no bloqueante)
        if: failure()
        run: echo "‚ö†Ô∏è La verificaci√≥n de notificaciones tuvo un problema (pero el job contin√∫a)"
