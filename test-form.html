<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Creación de Proceso</title>
</head>
<body>
    <h1>Test de Creación de Proceso</h1>
    <form id="procesoForm">
        <input type="text" id="expediente" placeholder="Expediente" value="TEST-2024-001" required>
        <input type="text" id="materia" placeholder="Materia" value="Cobranza" required>
        <input type="text" id="demandante" placeholder="Demandante" value="Juan Pérez García" required>
        <input type="text" id="demandado" placeholder="Demandado" value="María López Silva" required>
        <input type="text" id="juzgado" placeholder="Juzgado" value="1º Juzgado Civil de Lima">
        <button type="submit">Crear Proceso</button>
    </form>

    <div id="result"></div>

    <script>
        document.getElementById('procesoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                expediente: document.getElementById('expediente').value,
                tipo: 'Civil',
                materia: document.getElementById('materia').value,
                demandante: document.getElementById('demandante').value,
                demandado: document.getElementById('demandado').value,
                juzgado: document.getElementById('juzgado').value,
                estado: 'Activo',
                fecha_inicio: new Date().toISOString().split('T')[0],
                observaciones: 'Proceso creado desde test'
            };

            try {
                const response = await fetch('http://localhost:8000/api/v1/procesos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer test'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('result').innerHTML = `
                        <div style="color: green;">
                            ✅ Proceso creado exitosamente!<br>
                            ID: ${result.id}<br>
                            Expediente: ${result.expediente}
                        </div>
                    `;
                } else {
                    document.getElementById('result').innerHTML = `
                        <div style="color: red;">
                            ❌ Error: ${JSON.stringify(result)}
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `
                    <div style="color: red;">
                        ❌ Error de conexión: ${error.message}
                    </div>
                `;
            }
        });
    </script>
</body>
</html>